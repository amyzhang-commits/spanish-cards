<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spanish Verb Trainer - Offline First</title>

    <!-- PWA Meta Tags -->
    <meta name="description" content="Offline-first Spanish verb conjugation trainer with Anki-style flashcards">
    <meta name="theme-color" content="#1e40af">
    <link rel="manifest" href="/manifest.json">

    <!-- Icons for PWA -->
    <link rel="icon" type="image/x-icon" href="/icons/favicon.ico">
    <link rel="apple-touch-icon" href="/icons/icon-192.png">

    <!-- Styles -->
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="container">
        <!-- Offline Status Indicator -->
        <div id="offlineIndicator" class="offline-indicator" style="display: none;">
            📱 Working Offline
        </div>

        <!-- Sync Status Indicator -->
        <div id="syncIndicator" class="sync-indicator" style="display: none;">
            🔄 Syncing...
        </div>

        <header>
            <h1>🇪🇸 Spanish Verb Trainer</h1>
            <div class="status-bar">
                <span id="cardCount">0 cards stored locally</span>
                <span id="syncStatus">Ready</span>
            </div>
            <nav>
                <a href="index.html" class="nav-link active">Generate Verbs</a>
                <a href="sentences.html" class="nav-link">Process Sentences</a>
                <a href="study.html" class="nav-link">Study Cards</a>
                <a href="manage.html" class="nav-link">Manage Cards</a>
            </nav>
        </header>

        <main>
            <section class="generator-section">
                <h2>Verb Conjugation Generator</h2>
                <p>Generate comprehensive flashcards with context - works completely offline!</p>

                <div class="input-section">
                    <form id="verbForm">
                        <div class="form-group">
                            <label for="verbInput">Spanish Verb:</label>
                            <input
                                type="text"
                                id="verbInput"
                                placeholder="e.g., hablar, ser, soler..."
                                required
                                autocomplete="off"
                            >
                        </div>
                        <button type="submit" id="generateBtn">
                            <span class="btn-text">Analyze Verb</span>
                            <span class="spinner" style="display: none;">🧠</span>
                        </button>
                    </form>
                </div>

                <!-- Loading Section -->
                <div id="loadingSection" class="loading-section" style="display: none;">
                    <div class="loading-animation">
                        <div class="spinner-large">🧠</div>
                        <p id="loadingText">Analyzing verb...</p>
                        <small id="loadingSubtext">This may take 10-30 seconds</small>
                    </div>
                </div>

                <!-- Assessment Section -->
                <div id="assessmentSection" class="assessment-section" style="display: none;">
                    <div class="verb-assessment">
                        <h3 id="assessmentTitle">Verb Analysis</h3>
                        <div class="assessment-cards">
                            <div class="assessment-card">
                                <h4>🔍 Complexity</h4>
                                <span id="verbComplexity" class="complexity-badge"></span>
                            </div>
                            <div class="assessment-card">
                                <h4>📖 Overview</h4>
                                <p id="assessmentOverview"></p>
                            </div>
                            <div class="assessment-card">
                                <h4>⚠️ Special Notes</h4>
                                <p id="assessmentNotes"></p>
                            </div>
                            <div class="assessment-card">
                                <h4>🎯 Recommended Practice</h4>
                                <span id="recommendedPractice" class="practice-badge"></span>
                            </div>
                        </div>

                        <div class="generation-options">
                            <h4>Choose Your Practice Level:</h4>
                            <div class="option-buttons">
                                <button id="meaningOnlyBtn" class="option-btn">
                                    📝 Meaning Only
                                    <small>Just translation card</small>
                                </button>
                                <button id="coreBtn" class="option-btn">
                                    🎯 Core Practice
                                    <small>~20 essential conjugations</small>
                                </button>
                                <button id="fullBtn" class="option-btn">
                                    🔥 Full Treatment
                                    <small>Complete conjugation set</small>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Results Section -->
                <div id="resultsSection" class="results-section" style="display: none;">
                    <div class="verb-overview">
                        <h3 id="verbTitle">Generated Cards</h3>
                        <div class="context-cards">
                            <div class="context-card">
                                <h4>📖 Overview</h4>
                                <p id="verbOverview"></p>
                            </div>
                            <div class="context-card">
                                <h4>🔗 Related Verbs</h4>
                                <div id="relatedVerbs"></div>
                            </div>
                            <div class="context-card">
                                <h4>💡 Usage Notes</h4>
                                <p id="verbNotes"></p>
                            </div>
                        </div>
                    </div>

                    <div class="conjugations-preview">
                        <h4>Generated Cards Preview</h4>
                        <div class="stats">
                            <span id="cardCount">0 cards generated</span>
                        </div>

                        <div class="preview-grid" id="previewGrid">
                            <!-- Cards will be inserted here -->
                        </div>

                        <div class="action-buttons">
                            <button id="saveBtn" class="btn-primary">
                                💾 Save Cards Locally
                            </button>
                            <button id="generateAnotherBtn" class="btn-secondary">
                                ➕ Generate Another Verb
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Error Section -->
                <div id="errorSection" class="error-section" style="display: none;">
                    <div class="error-message">
                        <h4>❌ Generation Failed</h4>
                        <p id="errorText"></p>
                        <div class="error-actions">
                            <button id="retryBtn" class="btn-secondary">Try Again</button>
                            <button id="offlineBtn" class="btn-secondary" style="display: none;">
                                📱 Use Offline Mode
                            </button>
                        </div>
                    </div>
                </div>

                <!-- PWA Install Prompt -->
                <div id="installPrompt" class="install-prompt" style="display: none;">
                    <div class="install-card">
                        <h4>📱 Install App</h4>
                        <p>Install Spanish Verb Trainer for offline access and better performance!</p>
                        <div class="install-actions">
                            <button id="installBtn" class="btn-primary">Install App</button>
                            <button id="dismissInstallBtn" class="btn-secondary">Maybe Later</button>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Scripts -->
    <script src="/js/db.js"></script>
    <script src="/js/sync.js"></script>
    <script src="/js/app.js"></script>

    <!-- PWA Registration -->
    <script>
        // Register service worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // Handle PWA install prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installPrompt').style.display = 'block';
        });

        document.getElementById('installBtn').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User response to the install prompt: ${outcome}`);
                deferredPrompt = null;
                document.getElementById('installPrompt').style.display = 'none';
            }
        });

        document.getElementById('dismissInstallBtn').addEventListener('click', () => {
            document.getElementById('installPrompt').style.display = 'none';
        });
    </script>
</body>
</html>